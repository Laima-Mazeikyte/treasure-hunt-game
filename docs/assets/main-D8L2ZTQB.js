import{h as Fe,e as Pe,d as oe,i as Oe}from"./instantdb-D5dQ5UkJ.js";/* empty css              */const W=document.getElementById("grid-container"),z=40,ye=navigator.userAgent||"",qe=/Chrome/.test(ye)&&!/Edg|OPR|Brave|Chromium/.test(ye),Ne=!qe;let j=[],g=-1e3,y=-1e3,B=[],N=0,v=!1,b=!1,w=!1,O=null,E=[],p=1,_=3,ae=null,I=0,A=0,Z=!1,R=!1,q=null;function V(){document.body.classList.toggle("performance-mode",Ne&&v)}const Y={classic:{name:"Treasure Hunt",colors:{baseColor:{r:102,g:194,b:255},targetColor:{r:255,g:92,b:52},hazardColor:{r:53,g:30,b:40}},assets:{target:{src:"assets/target-gem-1.json",size:40},hazard:{src:"assets/hazard-skull.json",size:28}},copy:{gameTitle:"Treasure Hunt",themePrompt:"Select a theme:",levelPrompt:"Select a level to start:",levelButtonTemplate:"Level {level}",levelButtonSubtext:"{hazards} Hazards, {targets} Targets",legendTargetLabel:"Targets",legendHazardLabel:"Hazards",gameOverTitle:"Game Over!",gameOverMessage:"You were caught by a hazard!",levelCompleteTitle:"Level {level} complete!",levelCompleteMessage:"All targets found!",nextLevelCta:"Next Level",restartCta:"Restart Game",playAgainCta:"Play Again",saveScoreCta:"Save Score",finishRunCta:"Finish Run"},levelOverrides:{},dotGrid:{type:"symbols",characters:"▲◆•✦★◊",fontSize:20,fontFamily:"Arial, sans-serif",colorSource:"custom",color:{r:215,g:239,b:255}},dotBehavior:{pushRadius:150,maxPushDistance:60,scaleRadius:150,maxScale:1.5,visibilityRadius:250,fullVisibilityRadius:100,baseJitterAmount:2,dangerShakeAmount:20,dangerShakeExponent:1.5,dangerZone:200}},severance:{name:"Severance",colors:{baseColor:{r:0,g:139,b:146},targetColor:{r:226,g:250,b:251},hazardColor:{r:7,g:48,b:75}},assets:{target:{src:"assets/target-gem-1.json",size:40},hazard:{src:"assets/hazard-skull.json",size:28}},copy:{gameTitle:"Severance Hunt",themePrompt:"Select a theme:",levelPrompt:"Select a level to start:",levelButtonTemplate:"Level {level}",levelButtonSubtext:"{hazards} Hazards, {targets} Targets",legendTargetLabel:"Targets",legendHazardLabel:"Hazards",gameOverTitle:"Game Over!",gameOverMessage:"You were caught by a hazard!",levelCompleteTitle:"Level {level} complete!",levelCompleteMessage:"All targets found!",nextLevelCta:"Next Level",restartCta:"Restart Game",playAgainCta:"Play Again",saveScoreCta:"Save Score",finishRunCta:"Finish Run"},levelOverrides:{},dotGrid:{type:"mixed",characters:"ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",fontSize:14,fontFamily:"monospace",fontWeight:"bold",colorSource:"hazard"},dotBehavior:{pushRadius:150,maxPushDistance:60,scaleRadius:150,maxScale:1.5,visibilityRadius:250,fullVisibilityRadius:100,baseJitterAmount:2.5,dangerShakeAmount:20,dangerShakeExponent:1.5,dangerZone:200}},forest:{name:"Firefly Forest",colors:{baseColor:{r:52,g:97,b:69},targetColor:{r:255,g:185,b:80},hazardColor:{r:50,g:33,b:22}},assets:{target:{src:"assets/target-gem-1.json",size:40},hazard:{src:"assets/hazard-skull.json",size:28}},copy:{gameTitle:"Firefly Forest",themePrompt:"Select a theme:",levelPrompt:"Select a level to start:",levelButtonTemplate:"Level {level}",levelButtonSubtext:"{hazards} Hazards, {targets} Targets",legendTargetLabel:"Targets",legendHazardLabel:"Hazards",gameOverTitle:"Game Over!",gameOverMessage:"You were caught by a hazard!",levelCompleteTitle:"Level {level} complete!",levelCompleteMessage:"All targets found!",nextLevelCta:"Next Level",restartCta:"Restart Game",playAgainCta:"Play Again",saveScoreCta:"Save Score",finishRunCta:"Finish Run"},levelOverrides:{},dotGrid:{type:"symbols",characters:"▲◆•✦★◊",fontSize:10,fontFamily:"Arial, sans-serif"},dotBehavior:{pushRadius:200,maxPushDistance:40,scaleRadius:180,maxScale:1.3,visibilityRadius:280,fullVisibilityRadius:120,dangerShakeAmount:10,dangerShakeExponent:1.2,dangerZone:200}}};let h="classic",H={...Y.classic.colors.baseColor},K={...Y.classic.colors.targetColor},U={...Y.classic.colors.hazardColor};const he=400,fe=300;function L(e){return Y[e]||Y.classic}function se(e,t={}){return{...e,...t}}const X=new Map,pe=new Map;let M=null;function Ye(){if(M)return;const e={root:null,rootMargin:"50px",threshold:0};M=new IntersectionObserver(t=>{t.forEach(o=>{const s=X.get(o.target);s&&(o.isIntersecting?s.play?s.play():s.start&&s.start():s.pause&&s.pause())})},e)}Ye();class Xe{constructor(t,o){this.element=t,this.asset=o,this.isPlaying=!1,this.currentFrame=0,this.animationFrame=null,this.lastFrameTime=0}start(){this.isPlaying||(this.isPlaying=!0,this.lastFrameTime=performance.now(),this.animate())}animate(){if(!this.isPlaying)return;const t=performance.now(),o=this.asset.frameDuration||100;if(t-this.lastFrameTime>=o){this.currentFrame=(this.currentFrame+1)%this.asset.frames;const s=this.asset.size||40,n=-this.currentFrame*s;this.element.style.backgroundPosition=`${n}px 0`,this.lastFrameTime=t}this.animationFrame=requestAnimationFrame(()=>this.animate())}pause(){this.isPlaying=!1,this.animationFrame&&(cancelAnimationFrame(this.animationFrame),this.animationFrame=null)}destroy(){this.pause(),this.element=null}}function G(e){const t=X.get(e);t&&(t.destroy&&t.destroy(),X.delete(e)),M&&e&&M.unobserve(e)}async function Ge(e,t){try{let o=pe.get(t.src);if(!o){const n=await fetch(t.src);if(!n.ok)throw new Error(`Failed to load SVG: ${n.statusText}`);o=await n.text(),pe.set(t.src,o)}e.innerHTML=o;const s=e.querySelector("svg");return s&&(s.style.width="100%",s.style.height="100%",s.style.display="block"),!0}catch(o){return console.error("Error loading animated SVG:",o),!1}}function ve(){if(window.lottie){if(typeof window.lottie.loadAnimation=="function")return window.lottie;if(window.lottie.default&&typeof window.lottie.default.loadAnimation=="function")return window.lottie.default}return typeof lottie<"u"&&typeof lottie.loadAnimation=="function"?lottie:null}async function k(e,t){if(!e||!t||!t.src)return;const o=t.size||40;e.style.width=`${o}px`,e.style.height=`${o}px`,G(e),e.style.backgroundImage="",e.innerHTML="";let s=t.type;switch(s||(t.src.endsWith(".json")?s="lottie":t.src.endsWith(".svg")?s="svg":t.src.match(/\.(png|jpg|jpeg|gif|webp)$/i)&&(s=t.frames?"sprite":"image")),s){case"lottie":let n=ve(),a=0;const i=10;for(;!n&&a<i;)await new Promise(r=>setTimeout(r,100)),n=ve(),a++;if(n)try{e.parentNode||(console.warn("Element not in DOM yet, waiting..."),await new Promise(l=>{const u=setInterval(()=>{e.parentNode&&(clearInterval(u),l())},50);setTimeout(()=>{clearInterval(u),l()},1e3)})),e.style.backgroundImage="",e.style.backgroundSize="",e.style.backgroundRepeat="",e.style.backgroundPosition="",e.style.display="flex",e.style.alignItems="center",e.style.justifyContent="center",e.style.overflow="visible",e.style.width=`${o}px`,e.style.height=`${o}px`,console.log("Loading Lottie animation from:",t.src),console.log("Element details:",{inDOM:!!e.parentNode,display:e.style.display,width:e.style.width,height:e.style.height,opacity:window.getComputedStyle(e).opacity});const r=n.loadAnimation({container:e,renderer:"svg",loop:!0,autoplay:!0,path:t.src});console.log("Lottie animation instance created:",r),r.addEventListener("data_failed",l=>{console.error("Lottie animation failed to load:",t.src,l)}),r.addEventListener("DOMLoaded",()=>{console.log("Lottie animation DOM loaded:",t.src),e.setAttribute("lottie-rendered","true");const l=e.querySelector("svg");l?(l.style.width="100%",l.style.height="100%",l.style.display="block",l.style.position="absolute",l.style.top="0",l.style.left="0",console.log("SVG styled:",l),console.log("SVG dimensions:",{width:l.offsetWidth,height:l.offsetHeight,computedWidth:window.getComputedStyle(l).width,computedHeight:window.getComputedStyle(l).height})):(console.warn("No SVG found in element after DOMLoaded"),console.log("Element HTML:",e.innerHTML.substring(0,200)));const u=window.getComputedStyle(e);console.log("Element computed style:",{opacity:u.opacity,display:u.display,visibility:u.visibility,width:u.width,height:u.height})}),r.addEventListener("data_ready",()=>{console.log("Lottie animation data ready:",t.src)}),r.addEventListener("loaded_images",()=>{console.log("Lottie images loaded:",t.src)}),r.addEventListener("config_ready",()=>{console.log("Lottie config ready:",t.src)});const d=()=>{const l=e.querySelector("svg");return l?(l.style.width="100%",l.style.height="100%",l.style.display="block",l.style.position="absolute",l.style.top="0",l.style.left="0",console.log("SVG styled successfully"),!0):!1};d()||setTimeout(()=>{d()||setTimeout(d,200)},50),X.set(e,r),M&&M.observe(e)}catch(r){console.error("Error loading Lottie animation:",r,t.src),console.error("Error details:",r.stack),e.style.background="rgba(255, 0, 0, 0.3)",e.style.border="2px solid red"}else console.error("Lottie library not available after waiting. Asset:",t.src),console.error("window.lottie:",window.lottie),console.error("typeof lottie:",typeof lottie),e.style.background="rgba(255, 0, 0, 0.3)",e.style.border="2px solid red";break;case"animated-svg":await Ge(e,t);break;case"sprite":if(!t.frames){console.error("Sprite asset missing frames property");return}e.style.backgroundImage=`url(${t.src})`,e.style.backgroundSize=`${t.frames*100}% 100%`,e.style.backgroundRepeat="no-repeat",e.style.backgroundPosition="0 0";const c=new Xe(e,t);c.start(),X.set(e,c),M&&M.observe(e);break;default:e.style.backgroundImage=`url(${t.src})`,e.style.backgroundSize="contain",e.style.backgroundRepeat="no-repeat",e.style.backgroundPosition="center";break}}function re(e,t){return e.replace(/\{(\w+)\}/g,(o,s)=>Object.prototype.hasOwnProperty.call(t,s)?t[s]:o)}function Ve(e){return e.replace(/\s+/g," ").trim()}async function We(e){if(Z)return{ok:!1,error:"Score already saved for this run."};if(!Pe()||!oe)return{ok:!1,error:"Leaderboard is not configured yet."};const t={nickname:e,totalTargets:I,levelsCompleted:A,createdAt:Date.now()};try{return await oe.transact(oe.tx.leaderboard_entries[Oe()].update(t)),Z=!0,{ok:!0}}catch{return{ok:!1,error:"Could not save score. Please try again."}}}function Le({title:e,description:t}){const o=document.createElement("div");o.className="score-modal-overlay",o.innerHTML=`
        <div class="score-modal-card" role="dialog" aria-modal="true">
            <h2>${e}</h2>
            <p>${t}</p>
            <form class="score-form">
                <label class="score-label" for="score-nickname-input">Nickname</label>
                <input id="score-nickname-input" class="score-input" type="text" maxlength="20" placeholder="Your name" />
                <div class="score-error" aria-live="polite"></div>
                <div class="score-actions">
                    <button type="button" class="score-cancel">Cancel</button>
                    <button type="submit" class="score-submit">Save</button>
                </div>
            </form>
        </div>
    `;const s=o.querySelector("#score-nickname-input"),n=o.querySelector(".score-error"),a=o.querySelector(".score-cancel"),i=o.querySelector(".score-submit"),c=o.querySelector(".score-form"),r=()=>{o.remove(),document.removeEventListener("keydown",d)},d=l=>{l.key==="Escape"&&r()};Fe?Z&&(n.textContent="Score already saved for this run.",i.disabled=!0):(n.textContent="Leaderboard setup missing. Add your InstantDB app ID first.",i.disabled=!0),a.addEventListener("click",r),o.addEventListener("click",l=>{l.target===o&&r()}),c.addEventListener("submit",async l=>{l.preventDefault();const u=Ve(s.value||"");if(!u){n.textContent="Please enter a nickname.";return}if(u.length<2){n.textContent="Nickname must be at least 2 characters.";return}if(u.length>20){n.textContent="Nickname must be 20 characters or fewer.";return}i.disabled=!0,a.disabled=!0,i.textContent="Saving...",n.textContent="";const m=await We(u);if(!m.ok){i.disabled=!1,a.disabled=!1,i.textContent="Save",n.textContent=m.error;return}i.textContent="Saved!",setTimeout(()=>{window.location.href="leaderboard.html"},400)}),document.body.appendChild(o),document.addEventListener("keydown",d),s&&s.focus()}function Se(e){const t=document.getElementById("start-title"),o=document.getElementById("theme-prompt"),s=document.getElementById("level-prompt");t&&(t.textContent=e.copy.gameTitle),o&&(o.textContent=e.copy.themePrompt),s&&(s.textContent=e.copy.levelPrompt)}function we(e){const t=L(e);document.querySelectorAll(".level-button").forEach(o=>{const s=parseInt(o.getAttribute("data-level"),10),n=D(s,e),a=o.querySelector(".level-label"),i=o.querySelector(".level-subtext");a&&(a.textContent=re(t.copy.levelButtonTemplate,{level:s})),i&&(i.textContent=re(t.copy.levelButtonSubtext,{hazards:n.hazards,targets:n.targets}))})}function Me(e){const t=L(e),o=document.getElementById("target-label"),s=document.getElementById("hazard-label");o&&(o.textContent=t.copy.legendTargetLabel),s&&(s.textContent=t.copy.legendHazardLabel)}function Q(e,t){const o=D(e,t);k(document.getElementById("target-legend-icon"),o.assets.target),k(document.getElementById("hazard-legend-icon"),o.assets.hazard),k(document.getElementById("target-indicator-icon"),o.assets.target),k(document.getElementById("hazard-indicator-icon"),o.assets.hazard)}function D(e,t=h){const o=L(t),s=o.levelOverrides&&o.levelOverrides[e]?o.levelOverrides[e]:{},n=t===h&&ae?ae:{},a={...s.target,...n.target},i=e===1?0:Math.min(e-1,8),c=e<=2?3:3+(e-2)*2;return{hazards:i,targets:c,assets:{...o.assets.cursor?{cursor:se(o.assets.cursor,s.cursor)}:{},target:se(o.assets.target,a),hazard:se(o.assets.hazard,s.hazard)},movingHazards:!0}}function Te(){const e=D(p);E=[];const t=250,o=e.assets.hazard,s=o.size||40,n=s/2;for(let a=0;a<e.hazards;a++){const i=document.createElement("div");i.className="hazard",k(i,o);let c,r,d,l;do{c=Math.random()*(window.innerWidth-s*2)+s,r=Math.random()*(window.innerHeight-s*2)+s,d=E.some(C=>{const T=c-C.x,$=r-C.y;return Math.sqrt(T*T+$*$)<200});const x=c-g,f=r-y;l=Math.sqrt(x*x+f*f)<t}while(d||l);i.style.left=`${c-n}px`,i.style.top=`${r-n}px`,document.body.appendChild(i);const u=.5,m=Math.random()*Math.PI*2;E.push({element:i,x:c,y:r,size:s,velocityX:Math.cos(m)*u,velocityY:Math.sin(m)*u})}}function $e(){const e=D(p);_=e.targets,B=[];const t=200,o=e.assets.target,s=o.size||40,n=s/2;for(let a=0;a<e.targets;a++){const i=document.createElement("div");i.className="target";let c,r,d,l;do{c=Math.random()*(window.innerWidth-s*2)+s,r=Math.random()*(window.innerHeight-s*2)+s,d=E.some(f=>{const S=c-f.x,C=r-f.y;return Math.sqrt(S*S+C*C)<150});const u=c-g,m=r-y;l=Math.sqrt(u*u+m*m)<t}while(d||l);i.style.left=`${c-n}px`,i.style.top=`${r-n}px`,document.body.appendChild(i),k(i,o).catch(u=>{console.error("Failed to apply asset to target:",u)}),B.push({element:i,x:c,y:r,size:s,revealed:!1,hasBeenHovered:!1})}}function Je(e){return e[Math.floor(Math.random()*e.length)]}function je(e,t){if(!t){e.className="dot";return}if(t.type==="dots")e.className="dot";else{e.className="dot dot-text";const o=Je(t.characters);e.textContent=o,t.fontSize&&(e.style.fontSize=`${t.fontSize}px`),t.fontFamily&&(e.style.fontFamily=t.fontFamily),t.fontWeight&&(e.style.fontWeight=t.fontWeight)}}function ze(){const e=window.innerWidth,t=window.innerHeight,o=Math.ceil(e/z)+1,s=Math.ceil(t/z)+1;W.style.gridTemplateColumns=`repeat(${o}, ${z}px)`,W.style.gridTemplateRows=`repeat(${s}, ${z}px)`,W.innerHTML="",j=[];const a=L(h).dotGrid;for(let i=0;i<s;i++)for(let c=0;c<o;c++){const r=document.createElement("div");je(r,a);const d=c*z,l=i*z;j.push({element:r,originalX:d,originalY:l,currentX:d,currentY:l}),W.appendChild(r)}}function Ze(){D(p),v&&E.forEach(e=>{e.x+=e.velocityX,e.y+=e.velocityY;const t=Math.max(40,e.size);(e.x<t||e.x>window.innerWidth-t)&&(e.velocityX*=-1,e.x=Math.max(t,Math.min(window.innerWidth-t,e.x))),(e.y<t||e.y>window.innerHeight-t)&&(e.velocityY*=-1,e.y=Math.max(t,Math.min(window.innerHeight-t,e.y))),e.element.style.left=`${e.x-e.size/2}px`,e.element.style.top=`${e.y-e.size/2}px`})}function _e(){if(!b||!w){const t=L(h).dotBehavior||{pushRadius:150};for(let o of j){const s=g-o.originalX,n=y-o.originalY;if(Math.sqrt(s*s+n*n)<t.pushRadius)return!0}}return w}function ke(){const e=L(h),t=e.dotBehavior||{pushRadius:150,maxPushDistance:60,scaleRadius:150,maxScale:1.5,visibilityRadius:250,fullVisibilityRadius:100,dangerShakeAmount:20,dangerShakeExponent:1.5,dangerZone:200};let o=1/0;E.forEach(a=>{const i=g-a.x,c=y-a.y,r=Math.sqrt(i*i+c*c);r<o&&(o=r)});const s=o<t.dangerZone,n=s?1-o/t.dangerZone:0;j.forEach(a=>{const i=g-a.originalX,c=y-a.originalY,r=Math.sqrt(i*i+c*c);let d=0;r<t.fullVisibilityRadius?d=1:r<t.visibilityRadius&&(d=1-(r-t.fullVisibilityRadius)/(t.visibilityRadius-t.fullVisibilityRadius)),a.element.style.opacity=d;let l=1;const u=Math.max(t.scaleRadius||0,t.visibilityRadius||0);if(u>0&&(l=1+(1-Math.min(r,u)/u)*(t.maxScale-1)),r<t.pushRadius){let m=(1-r/t.pushRadius)*t.maxPushDistance;if(s){const x=t.hazardJitterBoost||1.6,f=Math.pow(n,t.dangerShakeExponent)*t.dangerShakeAmount*x,S=(Math.random()-.5)*f,C=(Math.random()-.5)*f,T=t.baseJitterAmount||0,$=(Math.random()-.5)*T,F=(Math.random()-.5)*T,P=Math.atan2(c,i),He=-Math.cos(P)*m+S+$,De=-Math.sin(P)*m+C+F;a.element.style.transform=`translate(${He}px, ${De}px) scale(${l})`;const me=Math.floor(n*220),te=ne(e,J),ge=`rgba(${Math.min(255,te.r+80)}, ${Math.max(0,te.g-me)}, ${Math.max(0,te.b-me)}, 0.6)`;a.element.classList.contains("dot-text")?a.element.style.color=ge:a.element.style.backgroundColor=ge}else{const x=Math.atan2(c,i),f=s&&t.baseJitterAmount||0,S=(Math.random()-.5)*f,C=(Math.random()-.5)*f,T=-Math.cos(x)*m+S,$=-Math.sin(x)*m+C,F=ne(e,J),P=`rgba(${F.r}, ${F.g}, ${F.b}, 0.5)`;a.element.style.transform=`translate(${T}px, ${$}px) scale(${l})`,a.element.classList.contains("dot-text")?a.element.style.color=P:a.element.style.backgroundColor=P}}else{const m=ne(e,J),x=`rgba(${m.r}, ${m.g}, ${m.b}, 0.5)`,f=s&&t.baseJitterAmount||0,S=(Math.random()-.5)*f,C=(Math.random()-.5)*f;a.element.style.transform=`translate(${S}px, ${C}px) scale(${l})`,a.element.classList.contains("dot-text")?a.element.style.color=x:a.element.style.backgroundColor=x}}),Ze(),requestAnimationFrame(ke)}function Ke(){let e=1/0,t=null;return B.forEach(o=>{if(!o.revealed&&!o.hasBeenHovered){const s=g-o.x,n=y-o.y,a=Math.sqrt(s*s+n*n);a<e&&(e=a,t=o)}}),t&&e<50?O!==t&&(O=t):O&&e>=50&&(O.hasBeenHovered=!0,O=null),e}function be(e,t,o){return{r:Math.round(e.r+(t.r-e.r)*o),g:Math.round(e.g+(t.g-e.g)*o),b:Math.round(e.b+(t.b-e.b)*o)}}function Be(){const e=document.getElementById("target-count");e.textContent=_-N}function Ue(){const e=document.getElementById("hazard-count"),t=D(p);e.textContent=t.hazards;const o=e.closest(".legend-item");o&&(o.style.display=t.hazards===0?"none":"flex")}function Ie(){Q(p,h)}function Qe(e,t){const o=document.getElementById("cursor-indicators"),s=document.getElementById("target-fill"),n=document.getElementById("hazard-fill"),a=25;o.style.left=`${g+a}px`,o.style.top=`${y}px`,o.style.opacity="1";const i=400,c=300,r=Math.max(0,Math.min(100,(1-e/i)*100)),d=Math.max(0,Math.min(100,(1-t/c)*100));s.style.width=`${r}%`,n.style.width=`${d}%`}function ie(){!q||!R||(q.style.left=`${g}px`,q.style.top=`${y}px`,q.style.transform="translate(-50%, -50%)")}function et(){q=document.getElementById("custom-cursor")}function tt(){const e=document.getElementById("start-title");if(!e)return;const t=e.textContent||"",o=()=>{const n=e.getBoundingClientRect();e.style.minHeight=`${n.height}px`,e.style.minWidth=`${n.width}px`,e.style.display="inline-block"},s=()=>{e.textContent="",e.style.visibility="visible";let n=0;const a=()=>{n<=t.length&&(e.textContent=t.slice(0,n),n+=1,setTimeout(a,80))};a()};document.fonts&&document.fonts.ready?document.fonts.ready.then(()=>{o(),s()}):(o(),s())}function xe(e,t,o=!1){const s=document.getElementById("instruction-text"),n=document.getElementById("instruction-overlay");if(!(!s||!n))if(n.style.display="block",n.style.opacity="1",n.classList.remove("dissolving"),o){s.innerHTML="";const a=document.createElement("div");a.innerHTML=e;const i=e;let c="",r="",d=!1,l=0;const u=()=>{if(l<i.length){const m=i[l];m==="<"?(d=!0,r="<"):m===">"&&d?(r+=">",c+=r,r="",d=!1):d?r+=m:c+=m,s.innerHTML=c,l++,setTimeout(u,25)}else setTimeout(()=>{n.classList.add("dissolving"),setTimeout(()=>{n.style.display="none",t&&t()},1e3)},100)};u()}else{s.textContent="";let a=0;const i=()=>{a<=e.length?(s.textContent=e.slice(0,a),a+=1,setTimeout(i,25)):setTimeout(()=>{n.classList.add("dissolving"),setTimeout(()=>{n.style.display="none",t&&t()},1e3)},100)};i()}}function Ce(e){const t=document.getElementById("instruction-text"),o=document.getElementById("instruction-overlay");!t||!o||(o.style.display="block",o.style.opacity="1",o.classList.remove("dissolving"),t.textContent="Start!",setTimeout(()=>{o.classList.add("dissolving"),setTimeout(()=>{o.style.display="none",e&&e()},1e3)},800))}function ot(){const e=document.getElementById("instruction-overlay");e&&(e.classList.add("dissolving"),setTimeout(()=>{e.style.display="none"},1e3))}function st(){const e=document.getElementById("classic-shapes-layer");if(!e)return;e.innerHTML="";const t=["▲","◆","•","✦","★","◊"],o=192;for(let s=0;s<o;s++){const n=document.createElement("div");n.className="classic-shape",n.textContent=t[Math.floor(Math.random()*t.length)];const a=Math.floor(Math.random()*26)+10,i=Math.random()*100,c=Math.random()*10+6,r=Math.random()*6,d=(Math.random()-.5)*40;n.style.fontSize=`${a}px`,n.style.left=`${i}%`,n.style.animationDuration=`${c}s`,n.style.animationDelay=`${r}s`,n.style.transform=`translateX(${d}px)`,e.appendChild(n)}}function nt(e){return{r:Math.min(255,e.r+120),g:Math.min(255,e.g+120),b:Math.min(255,e.b+120)}}function ne(e,t){return e.dotGrid?.colorSource==="custom"&&e.dotGrid.color?{...e.dotGrid.color}:e.dotGrid?.colorSource==="hazard"?{...e.colors.hazardColor}:nt(t)}let J={...H};function ee(){const e=Ke();let t=1/0;E.forEach(d=>{const l=g-d.x,u=y-d.y,m=Math.sqrt(l*l+u*u);m<t&&(t=m)}),Qe(e,t);let o={...H};if(e<he){const d=1-e/he;o=be(H,K,d)}if(t<fe){const d=1-t/fe;o=be(o,U,d)}J=o;const s=o,n={r:Math.max(0,o.r-20),g:Math.max(0,o.g-20),b:Math.max(0,o.b-20)},i=g/window.innerWidth*360,c=`rgb(${s.r}, ${s.g}, ${s.b})`,r=`rgb(${n.r}, ${n.g}, ${n.b})`;document.body.style.background=`linear-gradient(${i}deg, ${c} 0%, ${r} 100%)`}function at(e,t){const o=document.createElement("div");o.className="plus-one",o.textContent="+1",o.style.left=`${e}px`,o.style.top=`${t-30}px`,document.body.appendChild(o),setTimeout(()=>{o.remove()},1e3)}function le(){E.forEach(e=>{const t=g-e.x,o=y-e.y;Math.sqrt(t*t+o*o)<40&&rt()})}function rt(){v=!1,document.body.classList.remove("game-started"),V(),E.forEach(s=>{s.element.classList.add("revealed")});const e=document.createElement("div");e.id="game-over-screen";const t=L(h);e.innerHTML=`
        <h1>${t.copy.gameOverTitle}</h1>
        <p>${t.copy.gameOverMessage}</p>
        <p>Level: ${p}</p>
        <p>Targets found: ${N}/${_}</p>
        <p>Total targets collected: ${I}</p>
        <p>Levels completed: ${A}</p>
        <div class="score-actions-row">
            <button id="save-score-button">${t.copy.saveScoreCta}</button>
            <button id="restart-button">${t.copy.playAgainCta}</button>
        </div>
    `,document.body.appendChild(e),document.getElementById("restart-button").addEventListener("click",()=>{location.reload()});const o=document.getElementById("save-score-button");o&&o.addEventListener("click",()=>{Le({title:"Save your score",description:`Targets: ${I} · Levels: ${A}`})})}function it(){A+=1,v=!1,document.body.classList.remove("game-started"),V();const e=L(h),t=document.createElement("div");t.id="level-complete-screen",t.innerHTML=`
        <h1>${re(e.copy.levelCompleteTitle,{level:p})}</h1>
        <div class="score-actions-row">
            <button id="next-level-button">${e.copy.nextLevelCta}</button>
            <button id="finish-run-button">${e.copy.finishRunCta}</button>
            <button id="restart-button">${e.copy.restartCta}</button>
        </div>
    `,document.body.appendChild(t);const o=document.getElementById("next-level-button"),s=document.getElementById("finish-run-button"),n=document.getElementById("restart-button");o&&o.addEventListener("click",()=>{t.remove(),document.body.classList.add("game-started"),p++,b=!1,w=!1,Ae()}),n&&n.addEventListener("click",()=>{location.reload()}),s&&s.addEventListener("click",()=>{Le({title:"Save your score",description:`Targets: ${I} · Levels: ${A}`})})}function ce(){B.forEach(e=>{const t=g-e.x,o=y-e.y;Math.sqrt(t*t+o*o)<50&&!e.revealed&&(e.element.classList.add("revealed"),e.revealed=!0,N++,I++,Be(),at(e.x,e.y),ee(),N>=_&&setTimeout(()=>{it()},500))})}function Ae(){b=!1,v=!1,w=!1,document.body.classList.add("game-started"),N=0,ae=null,V(),document.getElementById("game-legend").style.display="flex",document.getElementById("level-indicator").style.display="block",lt(),B.forEach(e=>{G(e.element),e.element.remove()}),E.forEach(e=>{G(e.element),e.element.remove()}),ze(),Te(),$e(),Ue(),Be(),Ie(),Q(p,h),et(),p===1?xe(`Find the treasure
If it's <span style="color: #FF5C34;">red</span> the treasure is near`,()=>{Ce(()=>{b=!0})},!0):p===2?xe(`Find the treasure
If it's <span style="color: #FF5C34;">red</span> the treasure is near
If it's <span style="color: #351E28;">dark</span> there is danger`,()=>{Ce(()=>{b=!0})},!0):(ot(),b=!0)}function de(){!b||v||w||(w=!0,v=!0)}function Re(e=1){const t=document.getElementById("start-screen");t.style.display="none",document.body.classList.add("game-started"),I=0,A=0,Z=!1,p=e,V(),Ae(),ke()}function lt(){const e=document.getElementById("level-display");e&&(e.textContent=`Level ${p}`)}document.addEventListener("mousemove",e=>{const t=g,o=y;g=e.clientX,y=e.clientY,ie(),b&&!w&&!R&&(Math.abs(g-t)>2||Math.abs(y-o)>2)&&_e()&&de(),v&&(ee(),ce(),le())});document.addEventListener("mousedown",()=>{});document.addEventListener("mouseup",()=>{});document.addEventListener("touchstart",e=>{if(R||(R=!0,document.body.classList.add("touch-device")),v||b){e.preventDefault();const t=e.touches[0];g=t.clientX,y=t.clientY,ie(),b&&!w&&de(),v&&(ee(),ce(),le())}},{passive:!1});document.addEventListener("touchmove",e=>{if(R||(R=!0,document.body.classList.add("touch-device")),v||b){e.preventDefault();const t=e.touches[0];g=t.clientX,y=t.clientY,ie(),b&&!w&&de(),v&&(ee(),ce(),le())}},{passive:!1});document.addEventListener("touchend",e=>{(v||b)&&e.preventDefault()},{passive:!1});function ue(e){const t=e.colors.baseColor,o=`rgb(${t.r}, ${t.g}, ${t.b})`,s=`rgb(${Math.min(255,t.r+40)}, ${Math.min(255,t.g+40)}, ${Math.min(255,t.b+40)})`;document.body.style.background=`linear-gradient(135deg, ${o} 0%, ${s} 100%)`}document.querySelectorAll(".theme-button").forEach(e=>{e.addEventListener("click",()=>{document.querySelectorAll(".theme-button").forEach(o=>{o.classList.remove("selected")}),e.classList.add("selected"),h=e.getAttribute("data-theme");const t=L(h);H={...t.colors.baseColor},K={...t.colors.targetColor},U={...t.colors.hazardColor},ue(t),Se(t),we(h),Me(h),Q(p,h)})});document.querySelectorAll(".level-button").forEach(e=>{e.addEventListener("click",()=>{document.querySelectorAll(".level-button").forEach(o=>{o.classList.remove("selected")}),e.classList.add("selected");const t=parseInt(e.getAttribute("data-level"));setTimeout(()=>{Re(t)},300)})});const Ee=document.getElementById("start-button");Ee&&Ee.addEventListener("click",()=>{h="classic";const e=L("classic");H={...e.colors.baseColor},K={...e.colors.targetColor},U={...e.colors.hazardColor},ue(e),Re(1)});window.addEventListener("resize",()=>{v&&(ze(),B.forEach(e=>{G(e.element),e.element.remove()}),E.forEach(e=>{G(e.element),e.element.remove()}),Te(),$e(),Ie())});document.addEventListener("DOMContentLoaded",()=>{document.body.classList.remove("game-started"),V();const e=document.querySelector('.theme-button[data-theme="classic"]');if(e){e.classList.add("selected");const t=L("classic");H={...t.colors.baseColor},K={...t.colors.targetColor},U={...t.colors.hazardColor},ue(t),Se(t),we("classic"),Me("classic"),Q(1,"classic")}tt(),st(),ct()});async function ct(){try{const t=await(await fetch("version.json")).json(),o=document.getElementById("version-number");o&&t.version&&(o.textContent=`v${t.version}`)}catch(e){console.error("Failed to load version:",e)}}
