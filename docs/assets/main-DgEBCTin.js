import{h as He,e as Oe,d as ne,i as Pe}from"./instantdb-D5dQ5UkJ.js";/* empty css              */const G=document.getElementById("grid-container"),w=40,fe=navigator.userAgent||"",qe=/Chrome/.test(fe)&&!/Edg|OPR|Brave|Chromium/.test(fe),Ye=!qe;let j=[],g=-1e3,f=-1e3,B=[],Y=0,v=!1,M=!1,z=!1,P=null,E=[],p=1,U=3,re=null;const ye=new Map;let A=0,I=0,K=!1,R=!1,q=null;function W(){document.body.classList.toggle("performance-mode",Ye&&v)}const X={classic:{name:"Treasure Hunt",colors:{baseColor:{r:102,g:194,b:255},targetColor:{r:255,g:92,b:52},hazardColor:{r:53,g:30,b:40}},assets:{cursor:{src:"assets/cursor-eye.svg",size:32},target:{src:"assets/target-diamond.webp",size:40},hazard:{src:"assets/hazard-skull.webp",size:40},targetOptions:[{src:"assets/target-black-gem.webp",size:40},{src:"assets/target-diamond.webp",size:40},{src:"assets/target-red-gem.webp",size:40},{src:"assets/target-red-oval-gem.webp",size:40}],hazardOptions:[{src:"assets/hazard-skull.webp",size:40}]},copy:{gameTitle:"Treasure Hunt",themePrompt:"Select a theme:",levelPrompt:"Select a level to start:",levelButtonTemplate:"Level {level}",levelButtonSubtext:"{hazards} Hazards, {targets} Targets",legendTargetLabel:"Targets",legendHazardLabel:"Hazards",gameOverTitle:"Game Over!",gameOverMessage:"You were caught by a hazard!",levelCompleteTitle:"Level {level} complete!",levelCompleteMessage:"All targets found!",nextLevelCta:"Next Level",restartCta:"Restart Game",playAgainCta:"Play Again",saveScoreCta:"Save Score",finishRunCta:"Finish Run"},levelOverrides:{2:{target:{src:"assets/target-crown.svg"}},3:{target:{src:"assets/target-trophy.svg"}}},dotGrid:{type:"symbols",characters:"▲◆•✦★◊",fontSize:20,fontFamily:"Arial, sans-serif",colorSource:"custom",color:{r:215,g:239,b:255}},dotBehavior:{pushRadius:150,maxPushDistance:60,scaleRadius:150,maxScale:1.5,visibilityRadius:250,fullVisibilityRadius:100,baseJitterAmount:2,dangerShakeAmount:20,dangerShakeExponent:1.5,dangerZone:200}},severance:{name:"Severance",colors:{baseColor:{r:0,g:139,b:146},targetColor:{r:226,g:250,b:251},hazardColor:{r:7,g:48,b:75}},assets:{cursor:{src:"assets/cursor-eye.svg",size:32},target:{src:"assets/target-gem.webp",size:40},hazard:{src:"assets/hazard-skull.webp",size:40}},copy:{gameTitle:"Severance Hunt",themePrompt:"Select a theme:",levelPrompt:"Select a level to start:",levelButtonTemplate:"Level {level}",levelButtonSubtext:"{hazards} Hazards, {targets} Targets",legendTargetLabel:"Targets",legendHazardLabel:"Hazards",gameOverTitle:"Game Over!",gameOverMessage:"You were caught by a hazard!",levelCompleteTitle:"Level {level} complete!",levelCompleteMessage:"All targets found!",nextLevelCta:"Next Level",restartCta:"Restart Game",playAgainCta:"Play Again",saveScoreCta:"Save Score",finishRunCta:"Finish Run"},levelOverrides:{},dotGrid:{type:"mixed",characters:"ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",fontSize:14,fontFamily:"monospace",fontWeight:"bold",colorSource:"hazard"},dotBehavior:{pushRadius:150,maxPushDistance:60,scaleRadius:150,maxScale:1.5,visibilityRadius:250,fullVisibilityRadius:100,baseJitterAmount:2.5,dangerShakeAmount:20,dangerShakeExponent:1.5,dangerZone:200}},forest:{name:"Firefly Forest",colors:{baseColor:{r:52,g:97,b:69},targetColor:{r:255,g:185,b:80},hazardColor:{r:50,g:33,b:22}},assets:{cursor:{src:"assets/cursor-eye.svg",size:32},target:{src:"assets/target-gem.webp",size:40},hazard:{src:"assets/hazard-skull.webp",size:40}},copy:{gameTitle:"Firefly Forest",themePrompt:"Select a theme:",levelPrompt:"Select a level to start:",levelButtonTemplate:"Level {level}",levelButtonSubtext:"{hazards} Hazards, {targets} Targets",legendTargetLabel:"Targets",legendHazardLabel:"Hazards",gameOverTitle:"Game Over!",gameOverMessage:"You were caught by a hazard!",levelCompleteTitle:"Level {level} complete!",levelCompleteMessage:"All targets found!",nextLevelCta:"Next Level",restartCta:"Restart Game",playAgainCta:"Play Again",saveScoreCta:"Save Score",finishRunCta:"Finish Run"},levelOverrides:{},dotGrid:{type:"symbols",characters:"▲◆•✦★◊",fontSize:10,fontFamily:"Arial, sans-serif"},dotBehavior:{pushRadius:200,maxPushDistance:40,scaleRadius:180,maxScale:1.3,visibilityRadius:280,fullVisibilityRadius:120,dangerShakeAmount:10,dangerShakeExponent:1.2,dangerZone:200}}};let h="classic",F={...X.classic.colors.baseColor},Q={...X.classic.colors.targetColor},_={...X.classic.colors.hazardColor};const pe=400,ve=300;function b(e){return X[e]||X.classic}function ae(e,t={}){return{...e,...t}}function V(e){return e?typeof e=="string"?{src:e}:e:null}function Xe(e=[]){if(!e.length)return null;const t=e[Math.floor(Math.random()*e.length)];return V(t)}function Ne(e=[],t){if(!e.length)return null;if(e.length===1)return V(e[0]);const s=e.filter(o=>V(o)?.src!==t),n=s.length?s:e,a=n[Math.floor(Math.random()*n.length)];return V(a)}function Je(e=h){const t=b(e),s=ye.get(e)||{},n=Ne(t.assets?.targetOptions,s.targetSrc),a=Xe(t.assets?.hazardOptions);re={...n?{target:n}:{},...a?{hazard:a}:{}},n?.src&&ye.set(e,{...s,targetSrc:n.src})}const N=new Map,be=new Map;let L=null;function We(){if(L)return;const e={root:null,rootMargin:"50px",threshold:0};L=new IntersectionObserver(t=>{t.forEach(s=>{const n=N.get(s.target);n&&(s.isIntersecting?n.play?n.play():n.start&&n.start():n.pause&&n.pause())})},e)}We();class Ge{constructor(t,s){this.element=t,this.asset=s,this.isPlaying=!1,this.currentFrame=0,this.animationFrame=null,this.lastFrameTime=0}start(){this.isPlaying||(this.isPlaying=!0,this.lastFrameTime=performance.now(),this.animate())}animate(){if(!this.isPlaying)return;const t=performance.now(),s=this.asset.frameDuration||100;if(t-this.lastFrameTime>=s){this.currentFrame=(this.currentFrame+1)%this.asset.frames;const n=this.asset.size||40,a=-this.currentFrame*n;this.element.style.backgroundPosition=`${a}px 0`,this.lastFrameTime=t}this.animationFrame=requestAnimationFrame(()=>this.animate())}pause(){this.isPlaying=!1,this.animationFrame&&(cancelAnimationFrame(this.animationFrame),this.animationFrame=null)}destroy(){this.pause(),this.element=null}}function J(e){const t=N.get(e);t&&(t.destroy&&t.destroy(),N.delete(e)),L&&e&&L.unobserve(e)}async function Ve(e,t){try{let s=be.get(t.src);if(!s){const a=await fetch(t.src);if(!a.ok)throw new Error(`Failed to load SVG: ${a.statusText}`);s=await a.text(),be.set(t.src,s)}e.innerHTML=s;const n=e.querySelector("svg");return n&&(n.style.width="100%",n.style.height="100%",n.style.display="block"),!0}catch(s){return console.error("Error loading animated SVG:",s),!1}}async function k(e,t){if(!e||!t||!t.src)return;const s=t.size||40;e.style.width=`${s}px`,e.style.height=`${s}px`,J(e),e.style.backgroundImage="",e.innerHTML="";let n=t.type;switch(n||(t.src.endsWith(".json")?n="lottie":t.src.endsWith(".svg")?n="svg":t.src.match(/\.(png|jpg|jpeg|gif|webp)$/i)&&(n=t.frames?"sprite":"image")),n){case"lottie":if(window.lottie){const o=window.lottie.loadAnimation({container:e,renderer:"svg",loop:!0,autoplay:!0,path:t.src});N.set(e,o),L&&L.observe(e)}else console.warn("Lottie library not loaded");break;case"animated-svg":await Ve(e,t);break;case"sprite":if(!t.frames){console.error("Sprite asset missing frames property");return}e.style.backgroundImage=`url(${t.src})`,e.style.backgroundSize=`${t.frames*100}% 100%`,e.style.backgroundRepeat="no-repeat",e.style.backgroundPosition="0 0";const a=new Ge(e,t);a.start(),N.set(e,a),L&&L.observe(e);break;default:e.style.backgroundImage=`url(${t.src})`,e.style.backgroundSize="contain",e.style.backgroundRepeat="no-repeat",e.style.backgroundPosition="center";break}}function ie(e,t){return e.replace(/\{(\w+)\}/g,(s,n)=>Object.prototype.hasOwnProperty.call(t,n)?t[n]:s)}function Ze(e){return e.replace(/\s+/g," ").trim()}async function je(e){if(K)return{ok:!1,error:"Score already saved for this run."};if(!Oe()||!ne)return{ok:!1,error:"Leaderboard is not configured yet."};const t={nickname:e,totalTargets:A,levelsCompleted:I,createdAt:Date.now()};try{return await ne.transact(ne.tx.leaderboard_entries[Pe()].update(t)),K=!0,{ok:!0}}catch{return{ok:!1,error:"Could not save score. Please try again."}}}function Me({title:e,description:t}){const s=document.createElement("div");s.className="score-modal-overlay",s.innerHTML=`
        <div class="score-modal-card" role="dialog" aria-modal="true">
            <h2>${e}</h2>
            <p>${t}</p>
            <form class="score-form">
                <label class="score-label" for="score-nickname-input">Nickname</label>
                <input id="score-nickname-input" class="score-input" type="text" maxlength="20" placeholder="Your name" />
                <div class="score-error" aria-live="polite"></div>
                <div class="score-actions">
                    <button type="button" class="score-cancel">Cancel</button>
                    <button type="submit" class="score-submit">Save</button>
                </div>
            </form>
        </div>
    `;const n=s.querySelector("#score-nickname-input"),a=s.querySelector(".score-error"),o=s.querySelector(".score-cancel"),r=s.querySelector(".score-submit"),l=s.querySelector(".score-form"),i=()=>{s.remove(),document.removeEventListener("keydown",c)},c=d=>{d.key==="Escape"&&i()};He?K&&(a.textContent="Score already saved for this run.",r.disabled=!0):(a.textContent="Leaderboard setup missing. Add your InstantDB app ID first.",r.disabled=!0),o.addEventListener("click",i),s.addEventListener("click",d=>{d.target===s&&i()}),l.addEventListener("submit",async d=>{d.preventDefault();const m=Ze(n.value||"");if(!m){a.textContent="Please enter a nickname.";return}if(m.length<2){a.textContent="Nickname must be at least 2 characters.";return}if(m.length>20){a.textContent="Nickname must be 20 characters or fewer.";return}r.disabled=!0,o.disabled=!0,r.textContent="Saving...",a.textContent="";const u=await je(m);if(!u.ok){r.disabled=!1,o.disabled=!1,r.textContent="Save",a.textContent=u.error;return}r.textContent="Saved!",setTimeout(()=>{window.location.href="leaderboard.html"},400)}),document.body.appendChild(s),document.addEventListener("keydown",c),n&&n.focus()}function Se(e){const t=document.getElementById("start-title"),s=document.getElementById("theme-prompt"),n=document.getElementById("level-prompt");t&&(t.textContent=e.copy.gameTitle),s&&(s.textContent=e.copy.themePrompt),n&&(n.textContent=e.copy.levelPrompt)}function ze(e){const t=b(e);document.querySelectorAll(".level-button").forEach(s=>{const n=parseInt(s.getAttribute("data-level"),10),a=D(n,e),o=s.querySelector(".level-label"),r=s.querySelector(".level-subtext");o&&(o.textContent=ie(t.copy.levelButtonTemplate,{level:n})),r&&(r.textContent=ie(t.copy.levelButtonSubtext,{hazards:a.hazards,targets:a.targets}))})}function Le(e){const t=b(e),s=document.getElementById("target-label"),n=document.getElementById("hazard-label");s&&(s.textContent=t.copy.legendTargetLabel),n&&(n.textContent=t.copy.legendHazardLabel)}function ee(e,t){const s=D(e,t);k(document.getElementById("target-legend-icon"),s.assets.target),k(document.getElementById("hazard-legend-icon"),s.assets.hazard),k(document.getElementById("target-indicator-icon"),s.assets.target),k(document.getElementById("hazard-indicator-icon"),s.assets.hazard)}function D(e,t=h){const s=b(t),n=s.levelOverrides&&s.levelOverrides[e]?s.levelOverrides[e]:{},a=t===h&&re?re:{},o={...n.target,...a.target},r=e===1?0:Math.min(e-1,8),l=e<=2?3:3+(e-2)*2;return{hazards:r,targets:l,assets:{cursor:ae(s.assets.cursor,n.cursor),target:ae(s.assets.target,o),hazard:ae(s.assets.hazard,n.hazard)},movingHazards:!0}}function $e(){const e=D(p);E=[];const t=250,s=e.assets.hazard,n=s.size||40,a=n/2;for(let o=0;o<e.hazards;o++){const r=document.createElement("div");r.className="hazard",k(r,s);let l,i,c,d;do{l=Math.random()*(window.innerWidth-n*2)+n,i=Math.random()*(window.innerHeight-n*2)+n,c=E.some(C=>{const $=l-C.x,T=i-C.y;return Math.sqrt($*$+T*T)<200});const x=l-g,y=i-f;d=Math.sqrt(x*x+y*y)<t}while(c||d);r.style.left=`${l-a}px`,r.style.top=`${i-a}px`,document.body.appendChild(r);const m=.5,u=Math.random()*Math.PI*2;E.push({element:r,x:l,y:i,size:n,velocityX:Math.cos(u)*m,velocityY:Math.sin(u)*m})}}function Te(){const e=D(p);U=e.targets,B=[];const t=200,s=e.assets.target,n=s.size||40,a=n/2;for(let o=0;o<e.targets;o++){const r=document.createElement("div");r.className="target",k(r,s);let l,i,c,d;do{l=Math.random()*(window.innerWidth-n*2)+n,i=Math.random()*(window.innerHeight-n*2)+n,c=E.some(y=>{const S=l-y.x,C=i-y.y;return Math.sqrt(S*S+C*C)<150});const m=l-g,u=i-f;d=Math.sqrt(m*m+u*u)<t}while(c||d);r.style.left=`${l-a}px`,r.style.top=`${i-a}px`,document.body.appendChild(r),B.push({element:r,x:l,y:i,size:n,revealed:!1,hasBeenHovered:!1})}}function Ke(e){return e[Math.floor(Math.random()*e.length)]}function Ue(e,t){if(!t){e.className="dot";return}if(t.type==="dots")e.className="dot";else{e.className="dot dot-text";const s=Ke(t.characters);e.textContent=s,t.fontSize&&(e.style.fontSize=`${t.fontSize}px`),t.fontFamily&&(e.style.fontFamily=t.fontFamily),t.fontWeight&&(e.style.fontWeight=t.fontWeight)}}function we(){const e=window.innerWidth,t=window.innerHeight,s=Math.ceil(e/w)+1,n=Math.ceil(t/w)+1;G.style.gridTemplateColumns=`repeat(${s}, ${w}px)`,G.style.gridTemplateRows=`repeat(${n}, ${w}px)`,G.innerHTML="",j=[];const o=b(h).dotGrid;for(let r=0;r<n;r++)for(let l=0;l<s;l++){const i=document.createElement("div");Ue(i,o);const c=l*w,d=r*w;j.push({element:i,originalX:c,originalY:d,currentX:c,currentY:d}),G.appendChild(i)}}function Qe(){D(p),v&&E.forEach(e=>{e.x+=e.velocityX,e.y+=e.velocityY;const t=Math.max(40,e.size);(e.x<t||e.x>window.innerWidth-t)&&(e.velocityX*=-1,e.x=Math.max(t,Math.min(window.innerWidth-t,e.x))),(e.y<t||e.y>window.innerHeight-t)&&(e.velocityY*=-1,e.y=Math.max(t,Math.min(window.innerHeight-t,e.y))),e.element.style.left=`${e.x-e.size/2}px`,e.element.style.top=`${e.y-e.size/2}px`})}function _e(){if(!M||!z){const t=b(h).dotBehavior||{pushRadius:150};for(let s of j){const n=g-s.originalX,a=f-s.originalY;if(Math.sqrt(n*n+a*a)<t.pushRadius)return!0}}return z}function ke(){const e=b(h),t=e.dotBehavior||{pushRadius:150,maxPushDistance:60,scaleRadius:150,maxScale:1.5,visibilityRadius:250,fullVisibilityRadius:100,dangerShakeAmount:20,dangerShakeExponent:1.5,dangerZone:200};let s=1/0;E.forEach(o=>{const r=g-o.x,l=f-o.y,i=Math.sqrt(r*r+l*l);i<s&&(s=i)});const n=s<t.dangerZone,a=n?1-s/t.dangerZone:0;j.forEach(o=>{const r=g-o.originalX,l=f-o.originalY,i=Math.sqrt(r*r+l*l);let c=0;i<t.fullVisibilityRadius?c=1:i<t.visibilityRadius&&(c=1-(i-t.fullVisibilityRadius)/(t.visibilityRadius-t.fullVisibilityRadius)),o.element.style.opacity=c;let d=1;const m=Math.max(t.scaleRadius||0,t.visibilityRadius||0);if(m>0&&(d=1+(1-Math.min(i,m)/m)*(t.maxScale-1)),i<t.pushRadius){let u=(1-i/t.pushRadius)*t.maxPushDistance;if(n){const x=t.hazardJitterBoost||1.6,y=Math.pow(a,t.dangerShakeExponent)*t.dangerShakeAmount*x,S=(Math.random()-.5)*y,C=(Math.random()-.5)*y,$=t.baseJitterAmount||0,T=(Math.random()-.5)*$,H=(Math.random()-.5)*$,O=Math.atan2(l,r),Fe=-Math.cos(O)*u+S+T,De=-Math.sin(O)*u+C+H;o.element.style.transform=`translate(${Fe}px, ${De}px) scale(${d})`;const he=Math.floor(a*220),se=oe(e,Z),ge=`rgba(${Math.min(255,se.r+80)}, ${Math.max(0,se.g-he)}, ${Math.max(0,se.b-he)}, 0.6)`;o.element.classList.contains("dot-text")?o.element.style.color=ge:o.element.style.backgroundColor=ge}else{const x=Math.atan2(l,r),y=n&&t.baseJitterAmount||0,S=(Math.random()-.5)*y,C=(Math.random()-.5)*y,$=-Math.cos(x)*u+S,T=-Math.sin(x)*u+C,H=oe(e,Z),O=`rgba(${H.r}, ${H.g}, ${H.b}, 0.5)`;o.element.style.transform=`translate(${$}px, ${T}px) scale(${d})`,o.element.classList.contains("dot-text")?o.element.style.color=O:o.element.style.backgroundColor=O}}else{const u=oe(e,Z),x=`rgba(${u.r}, ${u.g}, ${u.b}, 0.5)`,y=n&&t.baseJitterAmount||0,S=(Math.random()-.5)*y,C=(Math.random()-.5)*y;o.element.style.transform=`translate(${S}px, ${C}px) scale(${d})`,o.element.classList.contains("dot-text")?o.element.style.color=x:o.element.style.backgroundColor=x}}),Qe(),requestAnimationFrame(ke)}function et(){let e=1/0,t=null;return B.forEach(s=>{if(!s.revealed&&!s.hasBeenHovered){const n=g-s.x,a=f-s.y,o=Math.sqrt(n*n+a*a);o<e&&(e=o,t=s)}}),t&&e<50?P!==t&&(P=t):P&&e>=50&&(P.hasBeenHovered=!0,P=null),e}function xe(e,t,s){return{r:Math.round(e.r+(t.r-e.r)*s),g:Math.round(e.g+(t.g-e.g)*s),b:Math.round(e.b+(t.b-e.b)*s)}}function Be(){const e=document.getElementById("target-count");e.textContent=U-Y}function tt(){const e=document.getElementById("hazard-count"),t=D(p);e.textContent=t.hazards;const s=e.closest(".legend-item");s&&(s.style.display=t.hazards===0?"none":"flex")}function Ae(){ee(p,h)}function st(e,t){const s=document.getElementById("cursor-indicators"),n=document.getElementById("target-fill"),a=document.getElementById("hazard-fill"),o=25;s.style.left=`${g+o}px`,s.style.top=`${f}px`,s.style.opacity="1";const r=400,l=300,i=Math.max(0,Math.min(100,(1-e/r)*100)),c=Math.max(0,Math.min(100,(1-t/l)*100));n.style.width=`${i}%`,a.style.width=`${c}%`}function le(){!q||!R||(q.style.left=`${g}px`,q.style.top=`${f}px`,q.style.transform="translate(-50%, -50%)")}function nt(){q=document.getElementById("custom-cursor")}function at(){const e=document.getElementById("start-title");if(!e)return;const t=e.textContent||"",s=()=>{const a=e.getBoundingClientRect();e.style.minHeight=`${a.height}px`,e.style.minWidth=`${a.width}px`,e.style.display="inline-block"},n=()=>{e.textContent="",e.style.visibility="visible";let a=0;const o=()=>{a<=t.length&&(e.textContent=t.slice(0,a),a+=1,setTimeout(o,80))};o()};document.fonts&&document.fonts.ready?document.fonts.ready.then(()=>{s(),n()}):(s(),n())}function Ce(e,t){const s=document.getElementById("instruction-text"),n=document.getElementById("instruction-overlay");if(!s||!n)return;n.style.display="block",s.textContent="";let a=0;const o=()=>{a<=e.length?(s.textContent=e.slice(0,a),a+=1,setTimeout(o,40)):t&&t()};o()}function ot(){const e=document.getElementById("instruction-overlay");e&&(e.style.display="none")}function rt(){const e=document.getElementById("classic-shapes-layer");if(!e)return;e.innerHTML="";const t=["▲","◆","•","✦","★","◊"],s=192;for(let n=0;n<s;n++){const a=document.createElement("div");a.className="classic-shape",a.textContent=t[Math.floor(Math.random()*t.length)];const o=Math.floor(Math.random()*26)+10,r=Math.random()*100,l=Math.random()*10+6,i=Math.random()*6,c=(Math.random()-.5)*40;a.style.fontSize=`${o}px`,a.style.left=`${r}%`,a.style.animationDuration=`${l}s`,a.style.animationDelay=`${i}s`,a.style.transform=`translateX(${c}px)`,e.appendChild(a)}}function it(e){return{r:Math.min(255,e.r+120),g:Math.min(255,e.g+120),b:Math.min(255,e.b+120)}}function oe(e,t){return e.dotGrid?.colorSource==="custom"&&e.dotGrid.color?{...e.dotGrid.color}:e.dotGrid?.colorSource==="hazard"?{...e.colors.hazardColor}:it(t)}let Z={...F};function te(){const e=et();let t=1/0;E.forEach(c=>{const d=g-c.x,m=f-c.y,u=Math.sqrt(d*d+m*m);u<t&&(t=u)}),st(e,t);let s={...F};if(e<pe){const c=1-e/pe;s=xe(F,Q,c)}if(t<ve){const c=1-t/ve;s=xe(s,_,c)}Z=s;const n=s,a={r:Math.max(0,s.r-20),g:Math.max(0,s.g-20),b:Math.max(0,s.b-20)},r=g/window.innerWidth*360,l=`rgb(${n.r}, ${n.g}, ${n.b})`,i=`rgb(${a.r}, ${a.g}, ${a.b})`;document.body.style.background=`linear-gradient(${r}deg, ${l} 0%, ${i} 100%)`}function lt(e,t){const s=document.createElement("div");s.className="plus-one",s.textContent="+1",s.style.left=`${e}px`,s.style.top=`${t-30}px`,document.body.appendChild(s),setTimeout(()=>{s.remove()},1e3)}function ce(){E.forEach(e=>{const t=g-e.x,s=f-e.y;Math.sqrt(t*t+s*s)<40&&ct()})}function ct(){v=!1,document.body.classList.remove("game-started"),W(),E.forEach(n=>{n.element.classList.add("revealed")});const e=document.createElement("div");e.id="game-over-screen";const t=b(h);e.innerHTML=`
        <h1>${t.copy.gameOverTitle}</h1>
        <p>${t.copy.gameOverMessage}</p>
        <p>Level: ${p}</p>
        <p>Targets found: ${Y}/${U}</p>
        <p>Total targets collected: ${A}</p>
        <p>Levels completed: ${I}</p>
        <div class="score-actions-row">
            <button id="save-score-button">${t.copy.saveScoreCta}</button>
            <button id="restart-button">${t.copy.playAgainCta}</button>
        </div>
    `,document.body.appendChild(e),document.getElementById("restart-button").addEventListener("click",()=>{location.reload()});const s=document.getElementById("save-score-button");s&&s.addEventListener("click",()=>{Me({title:"Save your score",description:`Targets: ${A} · Levels: ${I}`})})}function dt(){I+=1,v=!1,document.body.classList.remove("game-started"),W();const e=b(h),t=document.createElement("div");t.id="level-complete-screen",t.innerHTML=`
        <h1>${ie(e.copy.levelCompleteTitle,{level:p})}</h1>
        <div class="score-actions-row">
            <button id="next-level-button">${e.copy.nextLevelCta}</button>
            <button id="finish-run-button">${e.copy.finishRunCta}</button>
            <button id="restart-button">${e.copy.restartCta}</button>
        </div>
    `,document.body.appendChild(t);const s=document.getElementById("next-level-button"),n=document.getElementById("finish-run-button"),a=document.getElementById("restart-button");s&&s.addEventListener("click",()=>{t.remove(),document.body.classList.add("game-started"),p++,M=!1,z=!1,Ie()}),a&&a.addEventListener("click",()=>{location.reload()}),n&&n.addEventListener("click",()=>{Me({title:"Save your score",description:`Targets: ${A} · Levels: ${I}`})})}function de(){B.forEach(e=>{const t=g-e.x,s=f-e.y;Math.sqrt(t*t+s*s)<50&&!e.revealed&&(e.element.classList.add("revealed"),e.revealed=!0,Y++,A++,Be(),lt(e.x,e.y),te(),Y>=U&&setTimeout(()=>{dt()},500))})}function Ie(){M=!0,v=!1,z=!1,document.body.classList.add("game-started"),Y=0,Je(h),W(),document.getElementById("game-legend").style.display="flex",document.getElementById("level-indicator").style.display="block",ut(),B.forEach(e=>{J(e.element),e.element.remove()}),E.forEach(e=>{J(e.element),e.element.remove()}),we(),$e(),Te(),tt(),Be(),Ae(),ee(p,h),nt(),p===1?Ce("Find the treasure",()=>{}):p===2?Ce("Find the treasure, avoid the pirates",()=>{}):ot()}function ue(){!M||v||z||(z=!0,v=!0)}function Re(e=1){const t=document.getElementById("start-screen");t.style.display="none",document.body.classList.add("game-started"),A=0,I=0,K=!1,p=e,W(),Ie(),ke()}function ut(){const e=document.getElementById("level-display");e&&(e.textContent=`Level ${p}`)}document.addEventListener("mousemove",e=>{const t=g,s=f;g=e.clientX,f=e.clientY,le(),M&&!z&&!R&&(Math.abs(g-t)>2||Math.abs(f-s)>2)&&_e()&&ue(),v&&(te(),de(),ce())});document.addEventListener("mousedown",()=>{});document.addEventListener("mouseup",()=>{});document.addEventListener("touchstart",e=>{if(R||(R=!0,document.body.classList.add("touch-device")),v||M){e.preventDefault();const t=e.touches[0];g=t.clientX,f=t.clientY,le(),M&&!z&&ue(),v&&(te(),de(),ce())}},{passive:!1});document.addEventListener("touchmove",e=>{if(R||(R=!0,document.body.classList.add("touch-device")),v||M){e.preventDefault();const t=e.touches[0];g=t.clientX,f=t.clientY,le(),M&&!z&&ue(),v&&(te(),de(),ce())}},{passive:!1});document.addEventListener("touchend",e=>{(v||M)&&e.preventDefault()},{passive:!1});function me(e){const t=e.colors.baseColor,s=`rgb(${t.r}, ${t.g}, ${t.b})`,n=`rgb(${Math.min(255,t.r+40)}, ${Math.min(255,t.g+40)}, ${Math.min(255,t.b+40)})`;document.body.style.background=`linear-gradient(135deg, ${s} 0%, ${n} 100%)`}document.querySelectorAll(".theme-button").forEach(e=>{e.addEventListener("click",()=>{document.querySelectorAll(".theme-button").forEach(s=>{s.classList.remove("selected")}),e.classList.add("selected"),h=e.getAttribute("data-theme");const t=b(h);F={...t.colors.baseColor},Q={...t.colors.targetColor},_={...t.colors.hazardColor},me(t),Se(t),ze(h),Le(h),ee(p,h)})});document.querySelectorAll(".level-button").forEach(e=>{e.addEventListener("click",()=>{document.querySelectorAll(".level-button").forEach(s=>{s.classList.remove("selected")}),e.classList.add("selected");const t=parseInt(e.getAttribute("data-level"));setTimeout(()=>{Re(t)},300)})});const Ee=document.getElementById("start-button");Ee&&Ee.addEventListener("click",()=>{h="classic";const e=b("classic");F={...e.colors.baseColor},Q={...e.colors.targetColor},_={...e.colors.hazardColor},me(e),Re(1)});window.addEventListener("resize",()=>{v&&(we(),B.forEach(e=>{J(e.element),e.element.remove()}),E.forEach(e=>{J(e.element),e.element.remove()}),$e(),Te(),Ae())});document.addEventListener("DOMContentLoaded",()=>{document.body.classList.remove("game-started"),W();const e=document.querySelector('.theme-button[data-theme="classic"]');if(e){e.classList.add("selected");const t=b("classic");F={...t.colors.baseColor},Q={...t.colors.targetColor},_={...t.colors.hazardColor},me(t),Se(t),ze("classic"),Le("classic"),ee(1,"classic")}at(),rt(),mt()});async function mt(){try{const t=await(await fetch("version.json")).json(),s=document.getElementById("version-number");s&&t.version&&(s.textContent=`v${t.version}`)}catch(e){console.error("Failed to load version:",e)}}
